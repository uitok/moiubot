# ğŸ› MoiuBot é—®é¢˜è¯Šæ–­å’Œä¿®å¤æŠ¥å‘Š

**é—®é¢˜æ—¶é—´**: 2026-02-02 13:40 UTC
**ç—‡çŠ¶**: Bot å›å¤ææ…¢æˆ–ä¸å›å¤

---

## ğŸ” é—®é¢˜è¯Šæ–­

### ç—‡çŠ¶
- ç”¨æˆ·å‘é€ `/start` å Bot æ— å“åº”
- å®é™…ä¸Šæ˜¯ Bot **åå¤å´©æºƒå’Œé‡å¯**
- æ¯æ¬¡å›å¤å°è¯•éƒ½ä¼šå¤±è´¥

### æ ¹æœ¬åŸå› 

**Telegram API 400 é”™è¯¯**: `Can't parse entities`

```
TelegramError: 400: Bad Request: can't parse entities:
Can't find end of the entity starting at byte offset 454
```

**åŸå› **:
Bot å‘é€æ¶ˆæ¯æ—¶ä½¿ç”¨äº† `parse_mode: 'Markdown'`ï¼Œä½†æ¶ˆæ¯æ–‡æœ¬ä¸­åŒ…å«äº†ï¼š
- `<æœåŠ¡å™¨å>` - è¢«è§£æä¸ºæœªé—­åˆçš„ HTML æ ‡ç­¾
- `<hash>` - è¢«è§£æä¸ºæœªé—­åˆçš„ HTML æ ‡ç­¾
- `**å‘½ä»¤åˆ—è¡¨**` - Markdown ç²—ä½“æ ¼å¼

Telegram è¯•å›¾è§£æè¿™äº›"æ ‡ç­¾"ä½†å¤±è´¥äº†ï¼Œå¯¼è‡´ API è¿”å› 400 é”™è¯¯ï¼ŒBot å´©æºƒã€‚

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. åˆ›å»ºç®€åŒ–ç‰ˆå¤„ç†å™¨

åˆ›å»ºäº† `bot/handlers/start-simple.js`:
- ä½¿ç”¨çº¯æ–‡æœ¬æ¶ˆæ¯
- ä¸ä¾èµ–ä»»ä½•å¸¸é‡
- é¿å…æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦

### 2. éœ€è¦çš„åç»­ä¿®å¤

1. **ä¿®æ”¹æ‰€æœ‰æ¶ˆæ¯å¤„ç†å™¨** - ä½¿ç”¨çº¯æ–‡æœ¬æˆ–æ­£ç¡®çš„ Markdown è½¬ä¹‰
2. **ç¦ç”¨å…¨å±€ Markdown** - æˆ–ä»…åœ¨éœ€è¦æ—¶å¯ç”¨
3. **è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦** - `<` `>` `*` `_` ç­‰

### 3. æ¨èçš„ä¿®å¤æ–¹æ³•

**æ–¹æ³• A**: ç¦ç”¨ Markdownï¼ˆæœ€ç®€å•ï¼‰
```javascript
// åœ¨ bot/index.js ä¸­
bot.start((ctx) => handleStart(ctx));
// ä¸è®¾ç½® parse_modeï¼Œé»˜è®¤ä¸ºçº¯æ–‡æœ¬
```

**æ–¹æ³• B**: æ­£ç¡®è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
```javascript
// åœ¨ constants.js ä¸­
HELP: `å‘½ä»¤åˆ—è¡¨ï¼š\n\n/status \\[æœåŠ¡å™¨å\\]\n/pause \\[hash\\]`
```

**æ–¹æ³• C**: ä½¿ç”¨ HTML æ¨¡å¼å¹¶è½¬ä¹‰
```javascript
ctx.replyWithHTML('<b>ç²—ä½“</b> &lt;æœåŠ¡å™¨å&gt;')
```

---

## ğŸ¯ ç«‹å³è¡ŒåŠ¨

### æœ€å¿«çš„è§£å†³æ–¹æ¡ˆ

1. **ä¿®æ”¹ Bot å…¨å±€è®¾ç½®**ï¼Œç¦ç”¨ Markdown:
```javascript
// åœ¨ bot/index.js åˆ›å»º Bot åæ·»åŠ 
const bot = new Telegraf(process.env.TELEGRAM_BOT_TOKEN);
bot.use((ctx, next) => {
  ctx telegram = { ...ctx.telegram, options: {} }; // ç§»é™¤é»˜è®¤ parse_mode
  return next();
});
```

2. **æˆ–ä¿®æ”¹æ‰€æœ‰æ¶ˆæ¯å‘é€**ï¼Œæ˜ç¡®æŒ‡å®šçº¯æ–‡æœ¬:
```javascript
ctx.reply('æ¶ˆæ¯', { parse_mode: null });
```

3. **åˆ é™¤æ•°æ®åº“**é‡å¯:
```bash
cd /home/admin/github/moiubot
pkill -9 -f "node bot"
rm -f database/qbt-bot.db
node bot/config/database.js
node bot/index.js
```

---

## ğŸ“Š å½“å‰çŠ¶æ€

| ç»„ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Agent | âœ… æ­£å¸¸ | ç«¯å£ 3333 |
| qBittorrent | âœ… æ­£å¸¸ | ç«¯å£ 18080 |
| æ•°æ®åº“ | âœ… æ­£å¸¸ | å·²åˆå§‹åŒ– |
| Bot | âŒ å´©æºƒ | Markdown è§£æé”™è¯¯ |

---

## ğŸ’¡ æ€»ç»“

**é—®é¢˜**: Telegram Markdown è§£æå¤±è´¥å¯¼è‡´ Bot å´©æºƒ
**å½±å“**: æ‰€æœ‰éœ€è¦å‘é€æ¶ˆæ¯çš„å‘½ä»¤éƒ½ä¼šå¤±è´¥
**ä¿®å¤**: ç§»é™¤ Markdown æ ¼å¼æˆ–æ­£ç¡®è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
**ä¼˜å…ˆçº§**: ğŸ”´ **ç´§æ€¥** - é˜»å¡æ‰€æœ‰åŠŸèƒ½

---

**ä¸‹ä¸€æ­¥**: éœ€è¦é€‰æ‹©ä¸€ä¸ªä¿®å¤æ–¹æ¡ˆå¹¶å®æ–½
