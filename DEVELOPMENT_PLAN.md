# MoiuBot 后续开发计划 (Phase 3 & 4)

## 🎯 当前状态
- 已完成核心架构重构（CommonJS 统一、Logger 整合、错误处理标准化）。
- 已实现 Agent 端 qBittorrent 和 rclone 的基础控制。
- 已实现 Bot 端基础交互逻辑（/start, /add, /servers）。

## 🚀 待开发任务清单

### 1. 服务器管理完善 (Bot 端)
- [ ] **实现 `/add_server`**: 交互式添加新服务器（名称、API URL、API Key）。
- [ ] **实现 `/remove_server`**: 删除已注册的服务器。
- [ ] **实现 `/test_server`**: 测试指定服务器的连通性。

### 2. 任务管理增强 (Bot 端)
- [ ] **实现 `/list`**: 分服务器显示当前所有活跃的下载任务。
- [ ] **实现任务操作**: 对特定的 hash 执行 `/pause` (暂停)、`/resume` (恢复)、`/delete` (删除)。
- [ ] **实现 `/move`**: 对已下载完成但未移动的文件手动触发移动逻辑。

### 3. 配置管理 (Bot 端)
- [ ] **实现 `/categories`**: 管理 qBittorrent 分类与远程路径的预设映射。
- [ ] **实现 `/remotes`**: 实时查看各服务器可用的 rclone remotes 及其剩余空间。

### 4. 自动化与通知优化 (Agent & Bot)
- [ ] **Webhook 回调**: 当 Agent 完成文件移动后，主动向 Bot 发送 Webhook，Bot 实时推送“文件已归档”通知给用户。
- [ ] **下载进度实时预览**: 在 `/add` 后的消息中，通过编辑消息实时更新下载进度条。

### 5. 健壮性与安全
- [ ] **数据库清理**: 定期清理 tasks 表中的过期历史记录。
- [ ] **多用户权限**: 完善 ALLOWED_USERS 的细粒度权限控制。

---

## 🛠️ 执行指令 (给 Codex)
请根据上述计划，优先完成 **第 1 项（服务器管理）** 和 **第 2 项（任务管理）** 的代码实现。
1. 在 `bot/handlers/` 下创建或完善相应的处理器。
2. 在 `bot/index.js` 中注册新命令。
3. 确保与现有数据库逻辑兼容。
4. 开发完成后运行 `npm test` 验证。
